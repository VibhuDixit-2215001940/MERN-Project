<!DOCTYPE html>
<html>

<head>
    <title>Admin Dashboard</title>
    <meta charset="utf-8" />
    <link rel="icon" type="image/x-icon" href="/images/logo.jpg">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link type="text/css" rel="stylesheet" href="css/admin.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Raleway:wght@600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <section id="sidebar">
        <div class="sidebar-brand">
            <h2><i class="fa fa-cogs"></i>Swipe2Clean<span></span></h2>
        </div>
        <div class="sidebar-menu">
            <ul>
                <li><a href="#"><i class="fa fa-desktop"></i> <span>Control</span></a></li>
                <li><a href="#"><i class="fa fa-users"></i> <span>Workers</span></a></li>
                <li><a href="#"><i class="fa fa-files-o"></i> <span>Complaints</span></a></li>
                <li><a href="/Event"><i class="fa fa-flag-checkered"></i> <span>Events</span></a></li>
                <li><a href="#"><i class="fa fa-briefcase"></i> <span>Clients</span></a></li>
                <li><a href="#"><i class="fa fa-cart-arrow-down"></i> <span>Orders</span></a></li>
                <li><a href="#"><i class="fa fa-inr"></i> <span>Bids</span></a></li>
                <li><a href="#"><i class="fa fa-map"></i> <span>District Map</span></a></li>
                <li><a href="#"><i class="fa fa-book"></i> <span>Documents</span></a></li>
                <li><a href="/AdminLogout"><i class="fa fa-sign-out"></i> <span>Log out</span></a></li>
            </ul>
        </div>
    </section>

    <Section id="main-content">
        <header>
            <div class="header-left">
                <h2 class="toggle-btn">
                    Nagar Nigam Mathura
                </h2>
            </div>
            <div class="header-left header-serach">
                <div class="serach-par">
                    <input class="search" type="text" placeholder="Search">
                    <i class="fa fa-search"></i>
                </div>
            </div>
            <div class="header-left header-profile">
                <img src="images/user.png" class="img-responsive" />
                <h3><%= user.name %></h3>
                <p><%= user.lastLogin %></p>
            </div>
            <div class="clear"></div>
        </header>
        
        <div class="clear"></div>
        <div class="main-content-info container">
            <div class="card">
                <h2 class="cus-num cus-comp"><%= activeComplaints %></h2>
                <p>Active Complaints</p>
            </div>
            <div class="card">
                <h2 class="cus-num cus-ord"><%= activeusers %></h2>
                <p>Total Users</p>
            </div>
            <div class="card">
                <h2 class="cus-num cus-bid"><%= activeBiddings %></h2>
                <p>Active Workers</p>
            </div>
            <div class="card">
                <h2 class="cus-num cus-eve"><%= activeEvents %></h2>
                <p>Active Events</p>
            </div>
            <div class="clear"></div>
        </div>
                
        <div class="content-pro-par container">
            <div class="pro-table">
                <div class="recent-project">
                    <div class="rec-pro-h">
                        <h2>Ongoing Tasks</h2><p>(<%= activeComplaints %>)</p>
                    </div>
            
                    <div class="see-all">
                        <button>See all</button>
                    </div>
                    <div class="clear"></div>
                </div>
                <table style="width:100%">
                    <tr>
                        <th>Complain ID</th>
                        <th>Waste Type</th>
                        <th>Location</th>
                        <th>Status</th>
                    </tr>
                    <% complaints.forEach(complaint => { %>
                        <tr>
                            <td><%= complaint.id %></td>
                            <td><%= complaint.wasteType %></td>
                            <td><%= complaint.location %></td>
                            <td>
                                <span class="<%= complaint.status === 'Ongoing' ? 'rev-span' : complaint.status === 'Action Taken' ? 'progress-span' : 'pending-span' %>"></span>
                                <%= complaint.status %>
                            </td>
                        </tr>
                    <% }); %>
                </table>
                
            </div>
            
            <div class="pro-cus">
                <div class="recent-project">
                    <div class="rec-pro-h">
                        <h2>Workers</h2>
                    </div>
                    <table style="width:100%">
                        <tr>
                            <th>Name</th>
                            <th>Status</th>
                            <th>Contact</th>
                        </tr>
                        <% businessUsers.forEach(user => { %>
                            <tr>
                                <td><%= user.username %> [M]</td> <!-- Adjust gender if needed -->
                                <td>
                                    <% 
                                        // Calculate the time difference
                                        const lastLogin = new Date(user.lastLogin);
                                        const now = new Date();
                                        const timeDiff = now - lastLogin; // Time difference in milliseconds
                                        const hoursDiff = timeDiff / (1000 * 60 * 60); // Convert to hours
                                        const status = (hoursDiff < 24) ? 'Present' : 'Absent';
                                    %>
                                    <span class="rev-span">&nbsp;&nbsp;&nbsp;<%= status %></span>
                                    <span class="status-dot <%= (hoursDiff < 24) ? 'green-dot' : 'red-dot' %>"></span>
                                </td>
                                <td class="cnt-info-td"><i class="fa fa-phone"></i></td>
                            </tr>
                        <% }); %>
                    </table>
                </div>
            </div>
            <div class="clear"></div>
        </div>
    </Section>
    <div class="clear"></div>




    <script type="text/javascript" src="js/jquery-3.2.1.min.js"></script>
    <script type="text/javascript" src="js/external.js"></script>
</body>

</html>
